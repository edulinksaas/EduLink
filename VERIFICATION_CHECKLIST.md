# 강의실 설정 및 Supabase 연동 검증 체크리스트

## 1. 환경 변수 검증 (로컬/프리뷰/프로덕션)

### 로컬 환경
- [ ] 브라우저 콘솔에서 다음 로그 확인:
  ```
  🔍 Supabase 환경 변수 체크: {
    environment: "development",
    isProduction: false,
    isVercel: false,
    hasUrl: true,
    hasKey: true,
    ...
  }
  ```
- [ ] `hasUrl: true`, `hasKey: true` 확인
- [ ] `urlPreview`와 `keyPreview`에 실제 값이 표시되는지 확인

### 프리뷰 환경 (Vercel Preview)
- [ ] 브라우저 콘솔에서 환경 변수 체크 로그 확인
- [ ] `isVercel: true` 확인
- [ ] `hasUrl: true`, `hasKey: true` 확인
- [ ] 환경 변수가 `undefined`인 경우:
  - [ ] "⚠️ 배포 환경에서 환경 변수가 누락되었습니다!" 경고 확인
  - [ ] "Vercel 환경 변수 미주입 + redeploy 필요" 메시지 확인
  - [ ] Vercel 대시보드에서 환경 변수 설정 확인 후 재배포

### 프로덕션 환경 (Vercel Production)
- [ ] 브라우저 콘솔에서 환경 변수 체크 로그 확인
- [ ] `isProduction: true` 또는 `isVercel: true` 확인
- [ ] `hasUrl: true`, `hasKey: true` 확인
- [ ] 환경 변수가 `undefined`인 경우:
  - [ ] Vercel 대시보드 > Settings > Environment Variables 확인
  - [ ] `VITE_SUPABASE_URL` 설정 확인
  - [ ] `VITE_SUPABASE_ANON_KEY` 설정 확인
  - [ ] 환경 변수 추가 후 재배포

## 2. Supabase REST API 요청 헤더 검증

### 네트워크 탭에서 확인
- [ ] 브라우저 개발자 도구 > Network 탭 열기
- [ ] Supabase REST API 요청 필터링 (`/rest/v1/` 포함)
- [ ] 요청 헤더 확인:
  - [ ] `apikey` 헤더 존재 및 값 확인
  - [ ] `Authorization` 헤더 존재 및 값 확인
  - [ ] `Authorization` 헤더가 `Bearer {token}` 형식인지 확인

### 콘솔 로그에서 확인
- [ ] 브라우저 콘솔에서 다음 로그 확인:
  ```
  🌐 Supabase REST API 요청: {
    url: "...",
    method: "GET/POST/PUT/DELETE",
    hasApikey: true,
    hasAuthorization: true,
    apikeyLength: 100+,
    authLength: 100+,
    authPreview: "Bearer eyJ..."
  }
  ```
- [ ] `hasApikey: true`, `hasAuthorization: true` 확인
- [ ] `apikeyLength`와 `authLength`가 0보다 큰지 확인

### 401 Unauthorized 에러 발생 시
- [ ] 네트워크 탭에서 실패한 요청 확인
- [ ] 요청 헤더에 `apikey`와 `Authorization`가 있는지 확인
- [ ] 헤더 값이 올바른지 확인 (환경 변수와 일치하는지)
- [ ] 콘솔 로그에서 "❌ Supabase REST API 응답 오류" 확인
- [ ] 에러 상태 코드가 401인지 확인

## 3. 강의실 ID 기반 저장/전송/매칭 검증

### 설정 화면에서 강의실 선택
- [ ] 시간표 설정 > 강의실 설정 섹션 열기
- [ ] 드롭다운에서 기존 강의실 선택
- [ ] 콘솔에서 "✅ 강의실 선택 (ID 기반): {id}, {name}" 로그 확인
- [ ] 선택한 강의실 옆에 체크 표시(✓) 나타나는지 확인

### 새 강의실 추가
- [ ] 드롭다운에서 "+ 새 강의실 추가" 선택
- [ ] 새 강의실 이름 입력
- [ ] 저장 버튼 클릭
- [ ] 콘솔에서 "📝 강의실 생성 시도: {name}" 로그 확인
- [ ] 콘솔에서 "✅ 강의실 생성 완료: {name} {id}" 로그 확인
- [ ] 생성된 강의실이 드롭다운에 나타나는지 확인

### 저장 및 DB 확인
- [ ] 시간표 설정 저장 후 콘솔 확인:
  ```
  ✅ 관 1 (1관) 강의실 처리 완료: {
    IDs: ["uuid1", "uuid2", ...],
    count: 2
  }
  ```
- [ ] `IDs` 배열에 UUID 형식의 ID가 있는지 확인
- [ ] Supabase 대시보드에서 `timetable_settings` 테이블 확인:
  - [ ] `classroom_ids` 컬럼에 UUID 배열이 저장되었는지 확인
  - [ ] `building_classrooms` 컬럼에 관별 강의실 ID가 저장되었는지 확인
- [ ] `classrooms` 테이블에서 강의실 ID가 존재하는지 확인

### 로드 및 매칭 검증
- [ ] 페이지 새로고침 후 강의실 설정 로드 확인
- [ ] 콘솔에서 "📋 전체 강의실 목록: [{id: '...', name: '...'}, ...]" 로그 확인
- [ ] 콘솔에서 "📋 관 1 (1관)의 강의실 ID: [...]" 로그 확인
- [ ] 저장된 강의실 ID가 드롭다운에 올바르게 표시되는지 확인
- [ ] "⚠️ 설정에 강의실이 없습니다" 또는 "⚠️ 시간은 매칭되지만 강의실이 매칭되지 않음" 로그가 나타나지 않는지 확인

## 4. Classes.jsx에서 강의실 사용 검증

### 강의실 로드 확인
- [ ] Classes 페이지 열기
- [ ] 콘솔에서 "📋 DB에서 로드된 전체 강의실 목록" 로그 확인
- [ ] 콘솔에서 "✅ DB 시간표 설정에서 강의실 ID 로드: [...]" 로그 확인
- [ ] "⚠️ 설정에 강의실이 없습니다" 경고가 나타나지 않는지 확인
- [ ] "⚠️ 시간은 매칭되지만 강의실이 매칭되지 않음" 경고가 나타나지 않는지 확인

### 시간표 표시 확인
- [ ] Classes 페이지에서 시간표가 정상적으로 표시되는지 확인
- [ ] 각 시간 슬롯에 강의실이 올바르게 표시되는지 확인
- [ ] 강의실 이름이 설정한 이름과 일치하는지 확인

## 5. 전체 플로우 검증

### 시나리오 1: 새 강의실 추가 → 시간표에 사용
1. [ ] 설정 페이지에서 새 강의실 추가
2. [ ] 시간표 설정 저장
3. [ ] Classes 페이지에서 새 강의실이 드롭다운에 나타나는지 확인
4. [ ] 새 강의실로 수업 생성
5. [ ] 시간표에 수업이 올바르게 표시되는지 확인

### 시나리오 2: 기존 강의실 선택 → 시간표에 사용
1. [ ] 설정 페이지에서 기존 강의실 선택
2. [ ] 시간표 설정 저장
3. [ ] Classes 페이지에서 선택한 강의실이 사용 가능한지 확인
4. [ ] 해당 강의실로 수업 생성
5. [ ] 시간표에 수업이 올바르게 표시되는지 확인

### 시나리오 3: 강의실 삭제 → 시간표 영향 확인
1. [ ] 설정 페이지에서 강의실 삭제
2. [ ] 시간표 설정 저장
3. [ ] Classes 페이지에서 삭제된 강의실이 더 이상 표시되지 않는지 확인
4. [ ] 삭제된 강의실을 사용하던 수업이 어떻게 표시되는지 확인

## 6. 에러 케이스 검증

### 환경 변수 누락 시
- [ ] 로컬: `.env` 파일에서 환경 변수 제거 후 앱 실행
- [ ] 콘솔에 "❌ Supabase 환경 변수가 설정되지 않았습니다" 에러 확인
- [ ] 배포 환경: Vercel에서 환경 변수 제거 후 배포
- [ ] 콘솔에 "⚠️ 배포 환경에서 환경 변수가 누락되었습니다!" 경고 확인

### 네트워크 오류 시
- [ ] 네트워크 연결 끊기
- [ ] Supabase 요청 실패 시 적절한 에러 메시지 표시 확인
- [ ] 콘솔에 "❌ Supabase REST API 응답 오류" 로그 확인

### 강의실 ID 불일치 시
- [ ] DB에서 강의실 ID 수동 변경
- [ ] 설정 페이지 로드 시 "⚠️ 강의실 ID {id}를 찾을 수 없습니다" 경고 확인
- [ ] 빈 강의실로 표시되는지 확인

## 체크리스트 완료 후

모든 항목을 확인한 후:
- [ ] 문제가 발견되면 GitHub Issue 생성
- [ ] 로그 스크린샷 첨부
- [ ] 네트워크 탭 스크린샷 첨부 (헤더 확인용)
- [ ] Supabase 대시보드 스크린샷 첨부 (데이터 확인용)

